<%- contentFor('style') %>
<link rel="stylesheet" type="text/css" href="/stylesheets/registration.css" />

<%- contentFor('main') %>
<div class="content">
  <div class="slider-wrapper">
    <ul class="slider">
      <li>
        <input type="radio" class="mySlides" id="slide1" name="slide" checked>
        <label for="slide1"></label>
        <img src="/images/slide1.png" alt="Avalie filmes e séries">
        </li>
      <li>
        <input type="radio" class="mySlides" id="slide2" name="slide">
        <label for="slide2"></label>
        <img src="/images/slide2.png" alt="Armazene seus filmes favoritos em sua galeria" />
        </li>
        <li>
          <input type="radio" class="mySlides" id="slide3" name="slide">
          <label for="slide3"></label>
          <img src="/images/slide3.png" alt="Dê sua opinião sobre os títulos"/>
        </li>
      </ul>
  </div>
  <div class="content-form">
    <div class="title-wrapper">
      <h1 class="title">Crie uma conta</h1>
      <p>Criar uma conta é fácil e gratuito. Comece preenchendo o formulário abaixo.</p>
    </div>          
    <form method="post">
      <fieldset>
        <div class="field-wrapper">
          <label for="name">Nome de usuário</label>
          <input type="text" minlength="4" maxlength="50" name="user_name" id="name" required />
          <span class="erro-msg" id="name-erro"></span>
        </div>
        <div class="field-wrapper">
          <label for="password">Senha (8 caractéres no mínimo)</label>
          <input type="password" minlength="8" maxlength="50" name="user_password" id="password" required />
          <span class="erro-msg" id="password-erro"></span>
        </div>
        <div class="field-wrapper">
          <label for="password-confirm">Confirme sua senha</label>
          <input type="password" minlength="8" maxlength="50" name="user_password_confirm" id="password-confirm" required />
          <span class="erro-msg" id="password-confirmation-erro"></span>
        </div>
        <div class="field-wrapper">
          <label for="email">E-mail</label>
          <input type="email" name="user_email" id="email" placeholder="seuemail@exemplo.com" required />
          <span class="erro-msg" id="email-erro"></span>
        </div>
      </fieldset>
      <p>Ao clicar no botão "Registrar" abaixo, concordo com os termos de uso e a política de privacidade do M3D.</p>
      <input class="btn-submit" type="submit" value="Registrar">
    </form>
  </div>
</div>

<%# Script do slider %>
<script type="text/javascript">
  let slideIndex = 0;
  showSlides();
  
  function showSlides() {
    const slides = document.getElementsByClassName("mySlides");
    for (let i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";
    }
    slideIndex++;
    if (slideIndex > slides.length) {slideIndex = 1}
    slides[slideIndex-1].checked = "checked";
    setTimeout(showSlides, 5000);
  }

  // Verificação o campo password
  const password = document.querySelector("input#password");
  password.addEventListener('blur', () => {
    if (!passwordValidator()){
      document.querySelector("span#password-erro").innerHTML = 'A senha deve conter pelo menos 8 caractéres!';
    }
  });
  // Remove mensagem de erro
  password.addEventListener('focus', () => {
    document.querySelector("span#password-erro").innerHTML = '';
  });

  // Verificação o campo de e-mail
  const email = document.querySelector("input#email");
  email.addEventListener('blur', () => {
    if (emailValidator(email.value)){
      // Verificação de forma assincrona se o email está disponível
      fetch('/registration/emailAvailable/' + email.value, {
        method: 'GET'
      })
      .then(response => {
        if(!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(jsonResponse => {
        if(jsonResponse.available === 'false'){
          document.querySelector("span#email-erro").innerHTML = 'Endereço de e-mail já cadastrado';
        }
      });
    }
    else {
      document.querySelector("span#email-erro").innerHTML = 'Endereço de e-mail inválido!';
    }
  });
  // Remove mensagem de erro
  email.addEventListener('focus', () => {
    document.querySelector("span#email-erro").innerHTML = '';
  });
  
  function emailValidator(email) {
    const emailRegexp = new RegExp("^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$");
    return emailRegexp.test(email);
  }

  function passwordValidator(password) {
    const passwordRegexp = new RegExp("^([a-zA-Z0-9]{8,})$");
    return passwordRegexp.test(password);
  }
</script>